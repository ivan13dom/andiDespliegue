<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Dashboard de Asistente Virtual</title>

    <!-- Bootstrap CSS (opcional, para estilizar tablas y botones) -->
    <link 
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" 
      rel="stylesheet"
    />

    <style>
      body {
        background-color: #f8f9fa;
        padding: 2rem;
        font-family: 'Segoe UI', sans-serif;
      }
      h1, h2 {
        margin-bottom: 1rem;
      }
      .table-wrapper {
        max-height: 400px;
        overflow-y: auto;
        border: 1px solid #dee2e6;
        border-radius: 0.5rem;
        background: white;
      }
      .chart-container {
        max-width: 100%;
        margin-bottom: 2rem;
        background: white;
        padding: 1rem;
        border-radius: 0.5rem;
        box-shadow: 0 0 10px rgba(0,0,0,0.05);
      }
      .btn-download {
        margin-bottom: 1.5rem;
      }
    </style>
</head>
<body>
  <div class="container">
    <h1 class="mb-4">Dashboard: Uso del Asistente Virtual</h1>

    <!-- BotÃ³n para descargar todos los datos como CSV -->
    <a 
      href="/descargar" 
      class="btn btn-primary btn-download"
      target="_blank"
    >
      ðŸ“¥ Descargar todos los datos
    </a>


    <!-- GrÃ¡fico de lÃ­neas: Votos "SÃ­" vs "No" por dÃ­a -->
    <div class="chart-container">
      <h2>Votos por DÃ­a</h2>
      <canvas id="votosChart"></canvas>
    </div>


    <!-- Tabla: Top de sucursales por # de "SÃ­" -->
    <div class="mb-5">
      <h2>Top Sucursales (Personas que Usaron el Asistente Virtual)</h2>
      <div class="table-wrapper">
        <table class="table table-striped table-hover mb-0">
          <thead class="table-dark">
            <tr>
              <th>Sucursal</th>
              <th># de "SÃ­"</th>
            </tr>
          </thead>
          <tbody>
            {% for sucursal, cantidad in top_si %}
              <tr>
                <td>{{ sucursal }}</td>
                <td>{{ cantidad }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>


    <!-- Tabla: Ãšltimos 100 votos Ãºnicos -->
    <div class="mb-5">
      <h2>Ãšltimos 100 Votos Ãšnicos</h2>
      <div class="table-wrapper">
        <table class="table table-striped table-hover mb-0">
          <thead class="table-dark">
            <tr>
              <th>EnvÃ­o</th>
              <th>Fecha</th>
              <th>Sucursal</th>
              <th>Respuesta</th>
              <th>Comentario</th>
            </tr>
          </thead>
          <tbody>
            {% for envio, timestamp, sucursal, respuesta, comentario in ultimos_votos %}
              <tr>
                <td>{{ envio }}</td>
                <td>{{ timestamp.astimezone().strftime('%d/%m/%Y %H:%M') }}</td>
                <td>{{ sucursal }}</td>
                <td>{{ respuesta|capitalize }}</td>
                <td>{{ comentario or "" }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

  </div> <!-- /container -->

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const ctx = document.getElementById('votosChart').getContext('2d');

    const votosChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: {{ labels | tojson }},       // ["2025-05-10", "2025-05-11", ...]
        datasets: [
          {
            label: 'Votos "SÃ­"',
            data: {{ data_si | tojson }},    // [5, 7, 2, ...]
            borderColor: '#4CAF50',           // verde
            backgroundColor: 'rgba(76, 175, 80, 0.2)',
            tension: 0.3,
            fill: true
          },
          {
            label: 'Votos "No"',
            data: {{ data_no | tojson }},    // [3, 1, 4, ...]
            borderColor: '#F44336',           // rojo
            backgroundColor: 'rgba(244, 67, 54, 0.2)',
            tension: 0.3,
            fill: true
          }
        ]
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            position: 'top'
          }
        },
        scales: {
          y: { beginAtZero: true }
        }
      }
    });
  </script>
</body>
</html>
