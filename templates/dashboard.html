<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Dashboard ANDI – Uso de Asistente Virtual</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap 5.3 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-XLrE96gP--Dbo+1QfYk3aMVgdfnUpykD1Gf8eHVNCEsKCpPX1XSPANnK7Sm2r9E"
      crossorigin="anonymous"
    />

    <style>
      body {
        background-color: #f8f9fa;
        font-family: 'Segoe UI', sans-serif;
        padding: 2rem;
      }
      h1, h2 {
        margin-bottom: 1rem;
        color: #d71920; /* Rojo Andreani */
      }
      .table-wrapper {
        max-height: 350px;
        overflow-y: auto;
        border: 1px solid #dee2e6;
        border-radius: 0.5rem;
      }
      .chart-container {
        max-width: 100%;
        margin-bottom: 2rem;
      }
    </style>
</head>
<body>
  <div class="container">
    <h1 class="mb-4">Dashboard – Uso de ANDI en Sucursales</h1>

    <!-- GRÁFICO: Sí vs No por día -->
    <div class="mb-5">
      <h2>Usos de ANDI por Día</h2>
      <canvas id="andiChart" class="chart-container"></canvas>
    </div>

    <!-- TOP 10 sucursales con más “Sí” -->
    <div class="row mb-5">
      <div class="col-md-6">
        <h2>Top 10 – Cantidad de “Sí”</h2>
        <div class="table-wrapper">
          <table class="table table-striped table-hover">
            <thead class="table-dark">
              <tr>
                <th>Sucursal</th>
                <th>“Sí”</th>
              </tr>
            </thead>
            <tbody>
              {% for sucursal, cant in top_si %}
              <tr>
                <td>{{ sucursal }}</td>
                <td>{{ cant }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

      <!-- TOP 5 sucursales con mayor % de “Sí” -->
      <div class="col-md-6">
        <h2>Top 5 – % de “Sí”</h2>
        <div class="table-wrapper">
          <table class="table table-striped table-hover">
            <thead class="table-dark">
              <tr>
                <th>Sucursal</th>
                <th>% “Sí”</th>
                <th>Tot.</th>
                <th>“Sí”</th>
              </tr>
            </thead>
            <tbody>
              {% for sucursal, pct, si_count, total in top_pct %}
              <tr>
                <td>{{ sucursal }}</td>
                <td>{{ pct }} %</td>
                <td>{{ total }}</td>
                <td>{{ si_count }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- TABLA: Últimos 100 votos únicos -->
    <div class="mb-5">
      <h2>Últimos 100 Registros</h2>
      <div class="table-wrapper">
        <table class="table table-striped table-hover">
          <thead class="table-dark">
            <tr>
              <th># Envío</th>
              <th>Fecha y Hora (AR)</th>
              <th>Sucursal</th>
              <th>Respuesta</th>
              <th>Comentario</th>
            </tr>
          </thead>
          <tbody>
            {% for envio, ts, suc, resp, comm in ultimos_votos %}
            <tr>
              <td>{{ envio }}</td>
              <td>{{ ts.strftime("%d/%m/%Y %H:%M") }}</td>
              <td>{{ suc }}</td>
              <td>{{ resp|capitalize }}</td>
              <td>{{ comm or "" }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const ctx = document.getElementById("andiChart").getContext("2d");
    new Chart(ctx, {
      type: "line",
      data: {
        labels: {{ labels | tojson }},
        datasets: [
          {
            label: "Sí",
            data: {{ data_si | tojson }},
            borderColor: "#4CAF50",    // verde
            backgroundColor: "rgba(76, 175, 80, 0.2)",
            tension: 0.3,
            fill: true
          },
          {
            label: "No",
            data: {{ data_no | tojson }},
            borderColor: "#F44336",    // rojo
            backgroundColor: "rgba(244, 67, 54, 0.2)",
            tension: 0.3,
            fill: true
          }
        ]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: "top" }
        },
        scales: {
          y: {
            beginAtZero: true,
            precision: 0
          }
        }
      }
    });
  </script>
</body>
</html>
